version: '3'

services:
  api:
    image: mhart/alpine-node:10.8
    depends_on:
    - mongodb
    volumes:
    - .:/home/node
    working_dir: /home/node
    command: yarn start
    ports:
    - "3000:3000"

  mongodb:
    image: mvertes/alpine-mongo:4.0.0-0
    volumes:
    - mongodb:/data/db/
    ports:
      - "27017:27017"

  proxy:
    image: nginx:stable-alpine
    depends_on:
    - api
    volumes:
    - ./nginx/cert.pem:/etc/nginx/ssl/nginx.crt:ro
    - ./nginx/key.pem:/etc/nginx/ssl/nginx.key:ro
    - ./nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
    - "3333:80"
    - "4444:443"

volumes:
  mongodb:
